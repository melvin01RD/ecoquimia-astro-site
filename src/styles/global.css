/* Tailwind layers */
@tailwind base;
@tailwind components;
@tailwind utilities;

/* =========================
   Variables y bases globales
   ========================= */
@layer base {
  :root {
    /* Radios / elevación */
    --radius: 1rem;

    /* Color del anillo de enfoque (emerald-500) */
    --ring-r: 16;
    --ring-g: 185;
    --ring-b: 129;

    /* Gradiente para secciones oscuras (si las usas) */
    --bg-grad-from: 0 0% 0%;
    --bg-grad-to: 0 0% 8%;

    /* Esquema de color por defecto (mejor integración nativa) */
    color-scheme: light;
  }

  html {
    scroll-behavior: smooth;
    -webkit-text-size-adjust: 100%;
  }

  body {
    /* Por defecto: sitio claro (coincide con tu Base.astro actual) */
    @apply antialiased bg-white text-zinc-900;
    background-image: none;
    overflow-x: hidden; /* evita scroll lateral en mobile */
  }

  /* ====== Tema oscuro opcional por clase ======
     Úsalo en el <body> sólo cuando quieras contenido claro sobre fondo oscuro.
     Ej.: <body class="theme-dark"> … </body>
  */
  .theme-dark {
    @apply bg-zinc-950 text-white;
    color-scheme: dark;
  }
  .theme-dark,
  .theme-dark :where(p, li, span, small) {
    @apply text-white/90;
  }
  .theme-dark :where(h1, h2, h3, h4) {
    @apply text-white font-semibold tracking-tight;
  }

  /* Encabezados (mejor lectura cross-devices) */
  :where(h1) { @apply text-3xl md:text-4xl font-semibold leading-tight; }
  :where(h2) { @apply text-2xl md:text-3xl font-semibold leading-snug; }
  :where(h3) { @apply text-xl md:text-2xl font-semibold; }
  :where(h4) { @apply text-lg md:text-xl font-semibold; }
  :where(h1, h2, h3, h4) { text-wrap: balance; } /* quiebre amable en móvil */

  ::selection {
    background: rgba(var(--ring-r), var(--ring-g), var(--ring-b), 0.25);
    color: #fff;
  }

  :where(a, button, input, textarea, select, [role="button"]):focus-visible {
    outline: 2px solid rgb(var(--ring-r) var(--ring-g) var(--ring-b));
    outline-offset: 2px;
    border-radius: 0.5rem;
  }

  /* Tap highlight sutil (móvil) */
  :where(a, button) {
    -webkit-tap-highlight-color: rgba(var(--ring-r), var(--ring-g), var(--ring-b), 0.2);
  }

  /* Scrollbar sutil (WebKit) */
  *::-webkit-scrollbar { width: 10px; height: 10px; }
  *::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.15);
    border-radius: 999px;
  }
  .theme-dark *::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.15);
  }
  *::-webkit-scrollbar-thumb:hover { background: rgba(0,0,0,0.25); }
  .theme-dark *::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }

  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.001ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.001ms !important;
      scroll-behavior: auto !important;
    }
  }
}

/* =========================
   Componentes reutilizables
   ========================= */
@layer components {
  /* Container */
  .container-max { @apply max-w-6xl mx-auto px-4; }
  @media (max-width: 480px) {
    .container-max { @apply px-4; }
  }

  /* Header sólido (requiere class="site-header" en <header>) */
  .site-header {
    background-color: #000 !important;
    backdrop-filter: none !important; /* elimina blur si estaba */
  }
  .site-header, .site-header * { color: #fff; }

  /* Enlaces con subrayado solo al hover */
  a { text-underline-offset: 2px; }
  a:hover { text-decoration: underline; }
  /* Excepciones (CTA y tiles sin subrayado en hover) */
  a.btn:hover,
  .btn:hover,
  .tile-light:hover,
  a.no-underline:hover { text-decoration: none; }

  /* Botones base */
  .btn {
    @apply inline-flex items-center justify-center gap-2 rounded-2xl px-5 py-3 font-semibold
           transition duration-200 select-none;
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500;
    @apply disabled:opacity-50 disabled:pointer-events-none;
    transform: translateZ(0);
    white-space: nowrap; /* evita quiebres feos en mobile */
  }
  .btn-primary {
    @apply bg-emerald-600 text-white hover:bg-emerald-700 active:scale-[0.98] shadow-sm shadow-black/10;
  }
  .btn-secondary {
    @apply bg-zinc-900 text-white hover:bg-black active:scale-[0.98] border border-black/10;
  }
  .theme-dark .btn-secondary {
    @apply bg-white/10 text-white hover:bg-white/20 border border-white/10 backdrop-blur-sm;
  }
  .btn-outline {
    @apply border border-zinc-300 text-zinc-900 hover:bg-zinc-900 hover:text-white active:scale-[0.98];
  }
  .theme-dark .btn-outline {
    @apply border-white/60 text-white hover:bg-white hover:text-black;
  }
  .btn-ghost { @apply text-zinc-700 hover:text-zinc-900; }
  .theme-dark .btn-ghost { @apply text-white/70 hover:text-white hover:bg-white/10; }
  .btn-block { @apply w-full md:w-auto; } /* mobile-friendly */

  .btn[aria-busy="true"] { @apply relative pointer-events-none opacity-70; }
  .btn[aria-busy="true"]::after {
    content: "";
    @apply absolute inset-0 rounded-2xl;
    background-image: linear-gradient(90deg, transparent, rgba(0,0,0,0.08), transparent);
    background-size: 200% 100%;
    animation: btnShimmer 1.2s infinite;
  }
  .theme-dark .btn[aria-busy="true"]::after {
    background-image: linear-gradient(90deg, transparent, rgba(255,255,255,0.15), transparent);
  }
  @keyframes btnShimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }

  /* Tarjetas */
  .card {
    @apply rounded-3xl shadow-sm border border-zinc-200 bg-white text-zinc-900;
  }
  .theme-dark .card {
    @apply border-white/10 bg-white/5 text-white backdrop-blur-md;
  }
  .card-hover { @apply transition hover:-translate-y-0.5 hover:shadow-md; }

  /* Superficie sólida (secciones claras) */
  .surface {
    @apply rounded-3xl border border-zinc-200 bg-white text-zinc-900;
  }
  .theme-dark .surface {
    @apply border-white/10 bg-zinc-900/70 text-white backdrop-blur-sm;
  }

  /* ---------- OVERRIDES dentro de .surface ---------- */
  .surface :where(h1, h2, h3, h4) { @apply text-zinc-900; }
  .surface :where(p, li, span, small) { @apply text-zinc-800; }
  .surface .label { @apply text-zinc-700; }
  .surface .help { @apply text-zinc-500; }

  .surface .input,
  .surface .select,
  .surface .textarea {
    @apply bg-white text-zinc-900 placeholder-zinc-400 border border-zinc-300;
  }
  .surface .input:focus,
  .surface .select:focus,
  .surface .textarea:focus {
    @apply ring-emerald-500 border-emerald-500;
  }

  /* Tiles claras para listas (categorías) dentro de .surface */
  .tile-light {
    @apply rounded-[var(--radius)] p-4 border border-zinc-200 bg-white text-zinc-900
           hover:bg-zinc-50 transition card-hover no-underline;
  }

  /* Inputs globales (tema claro por defecto) */
  .field { @apply space-y-2; }
  .label { @apply text-sm font-medium text-zinc-700; }
  .input,
  .select,
  .textarea {
    @apply w-full rounded-xl px-3.5 py-2.5 bg-white text-zinc-900 placeholder-zinc-400
           border border-zinc-300 shadow-sm transition;
    @apply focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500 focus-visible:border-transparent;
  }
  .input[disabled],
  .select[disabled],
  .textarea[disabled] { @apply opacity-60 cursor-not-allowed; }

  /* Divisor */
  .divider { @apply h-px w-full bg-zinc-200; }
  .theme-dark .divider { @apply bg-white/10; }

  /* Badge */
  .badge {
    @apply inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-medium
           border border-zinc-200 bg-zinc-50 text-zinc-700;
  }
  .theme-dark .badge {
    @apply border-white/15 bg-white/5 text-white;
  }

  /* Nav links */
  .nav-link { @apply text-sm text-zinc-700 hover:text-zinc-900 transition; }
  .nav-link.is-active { @apply text-zinc-900 font-semibold; }
  .theme-dark .nav-link { @apply text-white/70 hover:text-white; }
  .theme-dark .nav-link.is-active { @apply text-white font-semibold; }
}

/* =========================
   Utilidades de ayuda
   ========================= */
@layer utilities {
  /* Imágenes y medios fluidos */
  img, video, canvas, svg { max-width: 100%; height: auto; display: block; }

  /* Grids fluidos */
  .auto-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 18rem), 1fr));
    gap: 1rem;
  }
  /* Variante más compacta para móviles angostos */
  .auto-grid-sm {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 14rem), 1fr));
    gap: 0.75rem;
  }

  /* Espaciado de secciones */
  .section-pad { @apply py-10 md:py-16; }

  /* Glass utilitario */
  .glass { @apply bg-white/5 border border-white/10 backdrop-blur-md; }

  /* Radio global utilitario */
  .rounded-app { border-radius: var(--radius); }

  /* Helpers mobile */
  .stack-sm { @apply space-y-3 md:space-y-4; } /* pilas verticales */
  .hide-on-mobile { @apply hidden sm:block; }
  .only-mobile { @apply sm:hidden; }

  /* Control de texto largo (evita roturas en mobile) */
  .nowrap { white-space: nowrap; }
  .break-anywhere { overflow-wrap: anywhere; word-break: break-word; }
}

/* ====== Variación “page-light” (si una vista debe forzarse clara) ====== */
@layer base {
  body.page-light {
    background-color: #f8fafc; /* slate-50 */
    background-image: none;
    @apply text-zinc-900;
    color-scheme: light;
  }
  body.page-light :where(p, li, span, small) { @apply text-zinc-900; }
  body.page-light :where(h1, h2, h3, h4) { @apply text-zinc-900; }
}

/* =========================
   Estados de formularios / a11y extra
   ========================= */

/* Estados de validez (no molestan hasta que el campo recibe foco) */
.input:focus-visible:invalid,
.select:focus-visible:invalid,
.textarea:focus-visible:invalid {
  @apply border-red-500 ring-2 ring-red-500;
}

.input:focus-visible:valid,
.select:focus-visible:valid,
.textarea:focus-visible:valid {
  @apply border-emerald-500 ring-2 ring-emerald-500;
}

/* Mejor feedback de focus */
.input:focus-visible,
.select:focus-visible,
.textarea:focus-visible {
  outline: none;
  box-shadow: 0 0 0 2px rgba(var(--ring-r), var(--ring-g), var(--ring-b), 0.35);
}

/* Autofill (Chrome/Safari) — respeta colores de tema claro/oscuro */
.input:-webkit-autofill,
.select:-webkit-autofill,
.textarea:-webkit-autofill {
  -webkit-text-fill-color: #18181b;
  transition: background-color 5000s ease-in-out 0s;
}
.theme-dark .input:-webkit-autofill,
.theme-dark .select:-webkit-autofill,
.theme-dark .textarea:-webkit-autofill {
  -webkit-text-fill-color: #fff;
}


/* ==== Ajustes UI para página de Contacto ==== */
@layer components {
  /* Tarjetas laterales y del formulario */
  .info-card { @apply card p-6 md:p-8; }
  .form-card { @apply card p-6 md:p-8; }

  /* Labels más legibles y consistentes */
  .label { @apply block mb-1; }

  /* Área de texto con altura mínima y resize vertical */
  .textarea { @apply min-h-[140px] resize-y; }
}


/* ==== Soporte layout Base/Header (actualizado) ==== */
@layer base {
  /* Altura mínima de la vista descontando el header (h-16 = 4rem) */
  main { min-height: calc(100svh - 4rem); }
}

@layer components {
  /* Fuerza menú del header en blanco (por encima de .nav-link por defecto) */
  .site-header .nav-link { @apply text-white/80 hover:text-white; }
  .site-header .nav-link.is-active { @apply text-white font-semibold; }

  /* Evita subrayado en CTA del header */
  .site-header .btn { text-decoration: none !important; }
}


/* ==============
   Notas rápidas:
   ==============
   - Por defecto el sitio es CLARO (bg blanco + texto oscuro). Para secciones
     con fondo oscuro, usa contenedores con clases .theme-dark en el body o
     secciones específicas (o aplica utilidades de Tailwind).
   - Usa .surface para bloques “claros”; dentro ya ajusta inputs/labels.
   - Grids: .auto-grid / .auto-grid-sm para colapsar bien en mobile.
   - .btn-block deja botones a 100% ancho en móviles automáticamente.
*/
