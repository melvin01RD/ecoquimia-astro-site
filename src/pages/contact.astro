---
import Base from "../layouts/Base.astro";
import { config } from "../config";

---

<meta name="description" content="Control profesional de plagas en Santo Domingo. Fumigación, desratización y sanitización certificada.">

<Base>
  <section class="bg-gradient-to-b from-white to-emerald-50/40">
    <div class="container-max py-10 md:py-14">
      <header class="mb-8 md:mb-10">
        <h1 class="text-2xl md:text-3xl font-bold text-zinc-900">Contacto</h1>
        <p class="text-zinc-600 mt-2">Cuéntanos qué necesitas y cómo prefieres que te contactemos.</p>
      </header>

      <!-- Grid principal -->
      <div class="grid gap-6 md:gap-8 md:grid-cols-[360px,1fr] items-start">
        <!-- Tarjeta izquierda -->
        <aside class="info-card">
          <h2 class="text-lg font-semibold text-zinc-900">Información de contacto</h2>
          <p class="text-zinc-600 mt-1">Escríbenos directo o usa el formulario.</p>

          <ul class="mt-4 space-y-3 text-zinc-700">
            <li><span class="font-medium">Email:</span> {config.contact.to}</li>
            <li><span class="font-medium">Teléfono:</span> {config.contact.phoneDisplay}</li>
            <li><span class="font-medium">Ubicación:</span> {config.contact.address}</li>
          </ul>

          <div class="mt-5 flex flex-wrap gap-3">
            <a href="/servicios" class="btn btn-outline">Ver servicios</a>
          </div>

          <p class="text-xs text-zinc-500 mt-5">
            Horario de atención: {config.contact.hours}
          </p>
        </aside>

        <!-- Tarjeta derecha: formulario -->
        <div class="form-card">
          <h2 class="text-lg font-semibold text-zinc-900">Envíanos un mensaje</h2>
          <p class="text-zinc-600 mt-1">Te responderemos lo antes posible.</p>

          <form id="contact-form" class="mt-6 space-y-5" method="post" action="/api/contact">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="label" for="name">Nombre y apellido</label>
                <input class="input" id="name" name="name" type="text" required minlength="3" autocomplete="name" placeholder="Tu nombre" />
              </div>
              <div>
                <label class="label" for="email">Email</label>
                <input class="input" id="email" name="email" type="email" required autocomplete="email" placeholder="tu@correo.com" />
              </div>
              <div>
                <label class="label" for="phone">Teléfono</label>
                <input class="input" id="phone" name="phone" type="tel" inputmode="tel" placeholder="+1 809 000 0000" />
              </div>
              <div>
                <label class="label" for="subject">Asunto</label>
                <input class="input" id="subject" name="subject" type="text" required placeholder="¿Sobre qué nos escribes?" />
              </div>
              <div class="md:col-span-2">
                <label class="label" for="message">Mensaje</label>
                <textarea class="textarea" id="message" name="message" required minlength="10" placeholder="Escribe los detalles de tu solicitud..."></textarea>
              </div>
            </div>

            <div class="flex flex-wrap gap-3 pt-2">
              <button class="btn btn-primary" type="submit">Enviar mensaje</button>

            <p id="contact-toast" class="hidden mt-4 text-sm"></p>
          </form>
        </div>
      </div>
    </div>
  </section>

  <script>
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const toast = document.getElementById('contact-toast');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!toast) return;

      const data = new FormData(form);
      
      // Reset toast state
      toast.classList.add('hidden');
      toast.classList.remove('text-emerald-700', 'text-red-600');

      try {
        const res = await fetch(form.action, { method: 'POST', body: data });
        const result = await res.json();
        
        toast.classList.remove('hidden');
        
        if (res.ok) {
          toast.classList.add('text-emerald-700');
          toast.textContent = result.message || '¡Gracias! Recibimos tu mensaje.';
          form.reset();
        } else {
          toast.classList.add('text-red-600');
          toast.textContent = result.error || 'No se pudo enviar. Intenta de nuevo.';
        }
      } catch (error) {
        toast.classList.remove('hidden');
        toast.classList.add('text-red-600');
        toast.textContent = 'Error de red. Intenta nuevamente.';
      }
    });
  </script>
</Base>
