---
// src/pages/contact.astro
import Base from "../layouts/Base.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
export const prerender = true;

const WHATSAPP = "https://wa.me/18296176004?text=Hola,%20quisiera%20información%20y%20una%20cotización";
---
<Base title="Contacto — Ecoquimia" description="Escríbenos por WhatsApp o completa el formulario. Respondemos rápido.">
  <Header slot="header" />

  <!-- Hero compacto -->
  <section class="relative overflow-hidden pt-12 md:pt-16">
    <div class="absolute inset-0 -z-10 bg-[radial-gradient(60%_60%_at_50%_0%,rgba(16,185,129,.08),rgba(255,255,255,0))]"></div>
    <div class="container-max text-center">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Contacto</h1>
      <p class="mt-2 text-zinc-600">Escríbenos por WhatsApp o completa el formulario y te respondemos en breve.</p>
    </div>
  </section>

  <!-- Contenido -->
  <section class="section-pad">
    <div class="container-max mx-auto max-w-5xl">
      <div class="grid gap-6 lg:gap-7 lg:grid-cols-5">
        <!-- Columna info -->
        <aside class="surface rounded-app p-5 md:p-6 lg:col-span-2">
          <ul class="space-y-3 text-[15px] leading-relaxed">
            <li><span class="font-medium">Email:</span> <a class="link" href="mailto:contacto@ecoquimia.com">contacto@ecoquimia.com</a></li>
            <li><span class="font-medium">Teléfono:</span> <a class="link" href="tel:+18096172105">+1 (809) 617-2105</a></li>
            <li><span class="font-medium">Ubicación:</span> Santo Domingo, RD</li>
          </ul>

          <div class="mt-5 flex flex-wrap gap-3">
            <a href={WHATSAPP} target="_blank" rel="noopener" class="btn btn-primary">Abrir WhatsApp</a>
            <a href="/services" class="btn btn-ghost">Ver servicios</a>
          </div>

          <p class="mt-4 text-xs text-zinc-500">
            Horario de atención: L–V 8:30 am–5:00 pm · Sáb. 9:00 am–1:00 pm
          </p>
        </aside>

        <!-- Columna formulario -->
        <div class="surface rounded-app p-5 md:p-6 lg:col-span-3">
          <form id="contactForm" name="contactForm" class="grid gap-4" method="post" action="/api/cotizacion" novalidate>
            <!-- honeypot -->
            <input type="text" name="website" class="hidden" tabindex="-1" autocomplete="organization" />

            <div class="grid gap-4 sm:grid-cols-2">
              <div class="field">
                <label class="label" for="name">Nombre completo</label>
                <input id="name" name="name" type="text" required placeholder="Tu nombre"
                  class="input h-10 md:h-11 text-sm md:text-base" />
              </div>

              <div class="field">
                <label class="label" for="phone">Teléfono</label>
                <input id="phone" name="phone" type="tel" inputmode="tel" placeholder="+1 (809) ..."
                  class="input h-10 md:h-11 text-sm md:text-base" />
              </div>

              <div class="field sm:col-span-2">
                <label class="label" for="email">Correo</label>
                <input id="email" name="email" type="email" required placeholder="correo@dominio.com"
                  class="input h-10 md:h-11 text-sm md:text-base" />
              </div>

              <div class="field sm:col-span-2">
                <label class="label" for="service">Asunto</label>
                <input id="service" name="service" type="text" required placeholder="¿Sobre qué te ayudamos?"
                  class="input h-10 md:h-11 text-sm md:text-base" />
              </div>

              <div class="field sm:col-span-2">
                <label class="label" for="message">Mensaje</label>
                <textarea id="message" name="message" rows={5} required placeholder="Cuéntanos tu caso"
                  class="textarea text-sm md:text-base"></textarea>
              </div>
            </div>

            <div class="mt-2 flex items-center gap-3">
              <button id="sendBtn" type="submit" class="btn btn-primary">Enviar</button>
              <a href={WHATSAPP} target="_blank" rel="noopener" class="btn btn-ghost">WhatsApp</a>
              <p id="status" class="text-sm" aria-live="polite"></p>
            </div>

            <p class="mt-2 text-xs text-zinc-500">
              Al enviar aceptas el uso de tus datos para responder a tu solicitud.
            </p>
          </form>
        </div>
      </div>
    </div>
  </section>

  <Footer slot="footer" />

  <script is:inline>
    // Submit por fetch (muestra respuesta al lado del botón)
    const form = document.getElementById('contactForm');
    const status = document.getElementById('status');
    const btn = document.getElementById('sendBtn');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!btn || !status) return;

      btn.setAttribute('aria-busy', 'true');
      status.textContent = 'Enviando...';
      status.className = 'text-sm text-zinc-600';

      const data = Object.fromEntries(new FormData(form));
      try {
        const r = await fetch('/api/cotizacion', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data),
        });
        const j = await r.json().catch(() => ({}));
        if (r.ok) {
          status.textContent = j.message || '¡Gracias! Te contactaremos pronto.';
          status.className = 'text-sm text-emerald-600';
          form.reset();
        } else {
          status.textContent = j.error || 'Error al enviar';
          status.className = 'text-sm text-red-600';
        }
      } catch {
        status.textContent = 'Error de red';
        status.className = 'text-sm text-red-600';
      } finally {
        btn.removeAttribute('aria-busy');
      }
    });
  </script>
</Base>
