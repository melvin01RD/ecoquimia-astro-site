---
import Base from "../layouts/Base.astro";
const waPhone = "18096172105";
const waText = "Hola, quiero una cotización de control de plagas.";
const waLink = `https://wa.me/${waPhone}?text=${encodeURIComponent(waText)}`;
---

<Base>
  <section class="bg-gradient-to-b from-white to-emerald-50/40">
    <div class="container-max py-10 md:py-14">
      <header class="mb-8 md:mb-10">
        <h1 class="text-2xl md:text-3xl font-bold text-zinc-900">Contacto</h1>
        <p class="text-zinc-600 mt-2">Cuéntanos qué necesitas y cómo prefieres que te contactemos.</p>
      </header>

      <!-- Grid principal -->
      <div class="grid gap-6 md:gap-8 md:grid-cols-[360px,1fr] items-start">
        <!-- Tarjeta izquierda -->
        <aside class="info-card">
          <h2 class="text-lg font-semibold text-zinc-900">Información de contacto</h2>
          <p class="text-zinc-600 mt-1">Escríbenos directo o usa el formulario.</p>

          <ul class="mt-4 space-y-3 text-zinc-700">
            <li><span class="font-medium">Email:</span> contacto@ecoquimia.com</li>
            <li><span class="font-medium">Teléfono:</span> +1 (809) 617-2105</li>
            <li><span class="font-medium">Ubicación:</span> Santo Domingo, RD</li>
          </ul>

          <div class="mt-5 flex flex-wrap gap-3">
            <a href={waLink} target="_blank" rel="noopener" class="btn btn-primary">Abrir WhatsApp</a>
            <a href="/services" class="btn btn-outline">Ver servicios</a>
          </div>

          <p class="text-xs text-zinc-500 mt-5">
            Horario de atención: L–V 8:30 am–5:00 pm · Sáb. 9:00 am–1:00 pm
          </p>
        </aside>

        <!-- Tarjeta derecha: formulario -->
        <div class="form-card">
          <h2 class="text-lg font-semibold text-zinc-900">Envíanos un mensaje</h2>
          <p class="text-zinc-600 mt-1">Te responderemos lo antes posible.</p>

          <form id="contact-form" class="mt-6 space-y-5" method="post" action="/api/contact">
            <div class="grid gap-4 md:grid-cols-2">
              <div>
                <label class="label" for="name">Nombre y apellido</label>
                <input class="input" id="name" name="name" type="text" required minlength="3" autocomplete="name" placeholder="Tu nombre" />
              </div>
              <div>
                <label class="label" for="email">Email</label>
                <input class="input" id="email" name="email" type="email" required autocomplete="email" placeholder="tu@correo.com" />
              </div>
              <div>
                <label class="label" for="phone">Teléfono</label>
                <input class="input" id="phone" name="phone" type="tel" inputmode="tel" placeholder="+1 809 000 0000" />
              </div>
              <div>
                <label class="label" for="subject">Asunto</label>
                <input class="input" id="subject" name="subject" type="text" required placeholder="¿Sobre qué nos escribes?" />
              </div>
              <div class="md:col-span-2">
                <label class="label" for="message">Mensaje</label>
                <textarea class="textarea" id="message" name="message" required minlength="10" placeholder="Escribe los detalles de tu solicitud..."></textarea>
              </div>
            </div>

            <div class="flex flex-wrap gap-3 pt-2">
              <button class="btn btn-primary" type="submit">Enviar mensaje</button>
              <a class="btn btn-outline" href={waLink} target="_blank" rel="noopener">WhatsApp</a>
            </div>

            <p id="contact-toast" class="hidden mt-4 text-sm"></p>
          </form>
        </div>
      </div>
    </div>
  </section>

  <script>
    const form = document.getElementById('contact-form');
    const toast = document.getElementById('contact-toast');

    form?.addEventListener('submit', async (e) => {
      e.preventDefault();
      const data = new FormData(form);
      try {
        const res = await fetch(form.action, { method: 'POST', body: data });
        const ok = res.ok;
        toast.className = ok ? 'mt-4 text-sm text-emerald-700' : 'mt-4 text-sm text-red-600';
        toast.textContent = ok ? '¡Gracias! Recibimos tu mensaje.' : 'No se pudo enviar. Intenta de nuevo.';
        if (ok) form.reset();
      } catch {
        toast.className = 'mt-4 text-sm text-red-600';
        toast.textContent = 'Error de red. Intenta nuevamente.';
      }
    });
  </script>
</Base>
