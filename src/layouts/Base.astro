---
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import WhatsAppButton from "../components/WhatsAppButton.astro";
import "../styles/global.css";

interface Props {
  title?: string;
  description?: string;
  /** Útil para entornos de preview */
  noIndex?: boolean;
}

const {
  title = "Ecoquimia",
  description = "Control de plagas en RD",
  noIndex = false,
} = Astro.props as Props;

// Rutas donde NO mostrar el botón de WhatsApp
const hiddenWhatsAppRoutes = ["/gracias", "/politicas", "/404", "/api/"];
const currentPath = Astro.url.pathname;
const showWhatsApp = !hiddenWhatsAppRoutes.some(
  (route) => currentPath === route || currentPath.startsWith(route)
);

const hasHeader = Astro.slots.has("header");
const hasFooter = Astro.slots.has("footer");

// --- DEFINICIÓN DEL SCHEMA (SEO LOCAL) ---
// Esto debe estar aquí arriba, en la zona de scripts
const schema = {
  "@context": "https://schema.org",
  "@type": "PestControl",
  "name": "Ecoquimia",
  "image": "https://www.ecoquimia.com.do/og-image.jpg",
  "@id": "https://www.ecoquimia.com.do",
  "url": "https://www.ecoquimia.com.do",
  "telephone": "+18097777586",
  "email": "contacto@ecoquimia.com",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Santo Domingo",
    "addressLocality": "Santo Domingo",
    "addressRegion": "Distrito Nacional",
    "postalCode": "10100",
    "addressCountry": "DO"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 18.4861,
    "longitude": -69.9312
  },
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      "opens": "08:30",
      "closes": "17:00"
    },
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": "Saturday",
      "opens": "09:00",
      "closes": "13:00"
    }
  ],
  "priceRange": "$$",
  "description": "Servicios profesionales de control de plagas y fumigación en Santo Domingo y República Dominicana. Soluciones efectivas y seguras para hogares y empresas."
};
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content={description} />
    {noIndex && <meta name="robots" content="noindex, nofollow" />}

    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="preconnect" href="/" />
    <link rel="dns-prefetch" href="//wa.me" />

    <title>{title}</title>

    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
  </head>
  
  <body>
    {hasHeader ? <slot name="header" /> : <Header />}
    <main class="min-h-screen">
      <slot />
    </main>
    {hasFooter ? <slot name="footer" /> : <Footer />}
    {showWhatsApp && <WhatsAppButton />}
  </body>
</html>